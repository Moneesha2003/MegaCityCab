<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Pricing Management</title>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <style>
            body {
                background-color: #002147;
                color: white;
                font-family: Arial, sans-serif;
                text-align: center;
            }
            form {
                margin: 20px auto;
                padding: 20px;
                background: white;
                color: #002147;
                width: 300px;
                border-radius: 10px;
            }
            input, button {
                margin: 5px;
                padding: 8px;
                width: 90%;
                border-radius: 5px;
                border: 1px solid #002147;
            }
            button {
                background: #002147;
                color: white;
                cursor: pointer;
            }
            table {
                width: 80%;
                margin: 20px auto;
                border-collapse: collapse;
                background: white;
                color: #002147;
            }
            th, td {
                padding: 10px;
                border: 1px solid #002147;
            }
            th {
                background: #002147;
                color: white;
            }
            .edit-btn {
                background: green;
                color: white;
                padding: 5px 10px;
                border: none;
                cursor: pointer;
                border-radius: 5px;
            }

            .update-btn {
                background: green;
                color: white;
                padding: 5px 10px;
                border: none;
                cursor: pointer;
                border-radius: 5px;
            }

            .delete-btn {
                background: red;
                color: white;
                padding: 5px 10px;
                border: none;
                cursor: pointer;
                border-radius: 5px;
            }

            .clear-btn {
                background-color: #666;
            }
            .clear-btn:hover {
                background-color: #444;
            }
        </style>
    </head>
    <body>
        <h2>Pricing Management</h2>
        <form id="pricingForm">
            <label>Vehicle Type:</label>
            <input type="text" id="vehicle_type" required><br>
            <label>Distance:</label>
            <input type="number" id="distance" required><br>
            <label>Passengers:</label>
            <input type="number" id="passengers" required><br>
            <label>Price:</label>
            <input type="number" id="price" required><br>
            <button type="submit" id="submitBtn">Add Pricing</button>
            <button type="button" id="updateBtn" style="display: none;">Update Pricing</button>
            <button class="clear-btn" onclick="clearForm()">Clear</button>
        </form>

        <h3>Pricing List</h3>
        <table id="pricingTable">
            <thead>
                <tr>
                    <th>Vehicle Type</th>
                    <th>Distance</th>
                    <th>Passengers</th>
                    <th>Price</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <script>
            let selectedVehicle = null; // Holds the vehicle type of the selected item for update

            $(document).ready(function () {
                fetchPricing();

                $("#pricingForm").submit(function (event) {
                    event.preventDefault();
                    let pricingData = {
                        vehicle_type: $("#vehicle_type").val(),
                        distance: parseFloat($("#distance").val()),
                        passengers: parseInt($("#passengers").val()),
                        price: parseFloat($("#price").val())
                    };

                    $.ajax({
                        url: "http://localhost:8080/MegaCity/api/pricing",
                        type: "POST",
                        contentType: "application/json",
                        data: JSON.stringify(pricingData),
                        success: function () {
                            alert("Pricing added successfully!");
                            fetchPricing();
                            $("#pricingForm")[0].reset();
                        }
                    });
                });

                $("#updateBtn").click(function () {
                    if (!selectedVehicle)
                        return;

                    let pricingData = {
                        vehicle_type: $("#vehicle_type").val(),
                        distance: parseFloat($("#distance").val()),
                        passengers: parseInt($("#passengers").val()),
                        price: parseFloat($("#price").val())
                    };

                    $.ajax({
                        url: `http://localhost:8080/MegaCity/api/pricing/${selectedVehicle}`,
                        type: "PUT",
                        contentType: "application/json",
                        data: JSON.stringify(pricingData),
                        success: function () {
                            alert("Pricing updated successfully!");
                            fetchPricing();
                            $("#pricingForm")[0].reset();
                            $("#updateBtn").hide();
                            $("#submitBtn").show();
                            selectedVehicle = null;
                        }
                    });
                });
            });

            function fetchPricing() {
                $.ajax({
                    url: "http://localhost:8080/MegaCity/api/pricing",
                    type: "GET",
                    success: function (data) {
                        let tableBody = "";
                        data.forEach(pricing => {
                            tableBody += `<tr>
                        <td>${pricing.vehicle_type}</td>
                        <td>${pricing.distance}</td>
                        <td>${pricing.passengers}</td>
                        <td>${pricing.price}</td>
                        <td>
                            <button class="edit-btn" onclick="editPricing('${pricing.vehicle_type}', ${pricing.distance}, ${pricing.passengers}, ${pricing.price})">Edit</button>
                            <button class="delete-btn" onclick="deletePricing('${pricing.vehicle_type}')">Delete</button>
                        </td>
                    </tr>`;
                        });
                        $("#pricingTable tbody").html(tableBody);
                    }
                });
            }


            function editPricing(vehicle_type, distance, passengers, price) {
                $("#vehicle_type").val(vehicle_type);
                $("#distance").val(distance);
                $("#passengers").val(passengers);
                $("#price").val(price);

                selectedVehicle = vehicle_type;

                $("#submitBtn").hide();
                $("#updateBtn").show();
            }

            function deletePricing(vehicle_type) {
                $.ajax({
                    url: `http://localhost:8080/MegaCity/api/pricing/${vehicle_type}`,
                    type: "DELETE",
                    success: function () {
                        alert("Pricing deleted successfully!");
                        fetchPricing();
                    }
                });
            }
            function clearForm() {
                document.getElementById('vehicle_type').value = "";
                document.getElementById('distance').value = "";
                document.getElementById('passengers').value = "";
                document.getElementById('price').value = "";
            }
        </script>
    </body>
</html>
