<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Admin Dashboard - Mega City Cab</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
        <style>
            /* Reuse the same CSS as the User Dashboard */
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
                font-family: 'Poppins', sans-serif;
            }

            body {
                display: flex;
                height: 100vh;
                background: url('assets/images/Taxi.jpg') center/cover no-repeat;
                background-attachment: fixed;
            }

            /* Sidebar */
            .sidebar {
                width: 250px;
                background: rgba(0, 0, 0, 0.8);
                color: white;
                display: flex;
                flex-direction: column;
                padding: 20px;
                align-items: center;
            }

            .sidebar h2 {
                font-size: 1.5rem;
                margin-bottom: 20px;
            }

            .nav-links {
                list-style: none;
                width: 100%;
            }

            .nav-links li {
                width: 100%;
                padding: 10px;
                margin: 10px 0;
                text-align: center;
                cursor: pointer;
                background: rgba(255, 255, 255, 0.2);
                border-radius: 5px;
                transition: background 0.3s;
            }

            .nav-links li:hover {
                background: #ffd700;
                color: black;
            }

            .nav-links li i {
                margin-right: 8px;
            }

            /* Main Content */
            .main-content {
                flex: 1;
                display: flex;
                justify-content: center;
                align-items: center;
                text-align: center;
                color: #333;
                background: rgba(255, 255, 255, 0.9);
                margin: 20px;
                padding: 30px;
                border-radius: 10px;
                box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
                animation: fadeIn 1s ease-in-out;
                width: 60%;
            }

            h1 {
                font-size: 2rem;
                margin-bottom: 15px;
            }

            /* Cab Cards Container */
            .cab-cards-container {
                display: flex;
                flex-wrap: wrap;
                gap: 20px;
                margin-top: 20px;
            }

            /* Cab Card */
            .cab-card {
                background-color: #fff;
                padding: 20px;
                border-radius: 8px;
                box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
                width: calc(33% - 20px); /* Three cards per row */
                text-align: center;
                transition: transform 0.3s ease;
            }

            .cab-card:hover {
                transform: translateY(-10px);
            }

            .cab-card h3 {
                font-size: 1.5rem;
                margin-top: 10px;
                color: #333;
            }

            .cab-card p {
                font-size: 1rem;
                color: #555;
            }

            .cab-card .button-group {
                display: flex;
                justify-content: center;
                gap: 10px;
                margin-top: 20px;
            }

            .cab-card button {
                padding: 10px 20px;
                border: none;
                border-radius: 5px;
                background-color: #ffd700;
                color: #333;
                font-size: 1rem;
                cursor: pointer;
                transition: background-color 0.3s ease;
            }

            .cab-card button:hover {
                background-color: #e6b800;
            }

            .cab-card button.delete-btn {
                background-color: #c9302c;
                color: white;
            }

            .cab-card button.delete-btn:hover {
                background-color: #d9534f;
            }

            /* Booking Table */
            .booking-table {
                width: 100%;
                border-collapse: collapse;
                margin-top: 20px;
            }

            .booking-table th, .booking-table td {
                padding: 12px;
                text-align: left;
                border-bottom: 1px solid #ddd;
            }

            .booking-table th {
                background-color: #ffd700;
                color: #333;
            }

            .booking-table tr:hover {
                background-color: #f5f5f5;
            }

            .booking-table button {
                padding: 8px 16px;
                border: none;
                border-radius: 5px;
                background-color: #c9302c;
                color: white;
                font-size: 1rem;
                cursor: pointer;
                transition: background-color 0.3s ease;
            }

            .booking-table button:hover {
                background-color: #d9534f;
            }
            /* Modal Overlay */
            .modal {
                display: none; /* Hidden by default */
                position: fixed; /* Stay in place */
                z-index: 1; /* Sit on top */
                left: 0;
                top: 0;
                width: 100%; /* Full width */
                height: 100%; /* Full height */
                overflow: auto; /* Enable scroll if needed */
                background-color: rgba(0, 0, 0, 0.5); /* Black with opacity */
            }

            /* Modal Content */
            .modal-content {
                background-color: #fefefe;
                margin: 10% auto; /* 10% from the top and centered */
                padding: 20px;
                border: 1px solid #888;
                border-radius: 8px;
                width: 90%; /* Responsive width */
                max-width: 500px; /* Maximum width */
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            }

            /* Close Button */
            .close {
                color: #aaa;
                float: right;
                font-size: 24px;
                font-weight: bold;
                cursor: pointer;
            }

            .close:hover,
            .close:focus {
                color: #000;
                text-decoration: none;
            }

            /* Modal Heading */
            .modal-content h2 {
                margin-top: 0;
                font-size: 24px;
                color: #333;
            }

            /* Input Fields */
            .modal-content input {
                width: 100%;
                padding: 10px;
                margin: 10px 0;
                border: 1px solid #ccc;
                border-radius: 4px;
                font-size: 16px;
            }

            /* Error Messages */
            .message {
                font-size: 14px;
                margin: 5px 0;
            }

            /* Buttons */
            .modal-content button {
                padding: 10px 20px;
                margin: 10px 5px 0 0;
                border: none;
                border-radius: 4px;
                font-size: 16px;
                cursor: pointer;
                transition: background-color 0.3s ease;
            }

            .modal-content button:hover {
                opacity: 0.9;
            }

            /* Add Cab Button */
            .modal-content button:first-of-type {
                background-color: #4CAF50; /* Green */
                color: white;
            }

            /* Clear Button */
            .modal-content .clear-btn {
                background-color: #f44336; /* Red */
                color: white;
            }

            /* Responsive Design */
            @media (max-width: 600px) {
                .modal-content {
                    margin: 20% auto; /* Adjust margin for smaller screens */
                }
            }
            @keyframes fadeIn {
                from {
                    opacity: 0;
                    transform: translateY(-20px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
        </style>
    </head>
    <body>
        <!-- Sidebar -->
        <div class="sidebar">
            <h2>Admin Dashboard</h2>
            <ul class="nav-links">
                <li onclick="showManageCabs()"><i class="fa-solid fa-car"></i> Manage Cabs</li>
                <li onclick="showManageBookings()"><i class="fa-solid fa-list"></i> Manage Bookings</li>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="main-content" id="main-content">
            <h1 id="welcome-msg">Welcome, Admin!</h1>
        </div>

        <!-- Add New Cab Modal -->
        <div id="add-cab-modal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeAddCabModal()">&times;</span>
                <h2>Add New Cab</h2>

                <input type="text" id="vehicle" placeholder="Vehicle Name">
                <p id="vehicleError" class="message" style="color: red;"></p>

                <input type="text" id="driver" placeholder="Driver">
                <p id="driverError" class="message" style="color: red;"></p>

                <input type="number" id="passengers" placeholder="Passenger Capacity">
                <p id="passengersError" class="message" style="color: red;"></p>

                <input type="number" id="price_per_km" placeholder="Price per km">
                <p id="price_per_kmError" class="message" style="color: red;"></p>

                <button onclick="addCab()">Add Cab</button>
                <button class="clear-btn" onclick="clearForm()">Clear</button>

                <p class="message" id="message"></p>
            </div>
        </div>

        <script>
                    // Function to show the "Add New Cab" modal
                    function showAddCabModal() {
                        const modal = document.getElementById("add-cab-modal");
                        modal.style.display = "block";
                    }

                    // Function to close the "Add New Cab" modal
                    function closeAddCabModal() {
                        const modal = document.getElementById("add-cab-modal");
                        modal.style.display = "none";
                    }

                    // Function to add a new cab
                    function addCab() {
                        const vehicle = document.getElementById('vehicle').value;
                        const driver = document.getElementById('driver').value;
                        const passengers = document.getElementById('passengers').value;
                        const price_per_km = document.getElementById('price_per_km').value;
                        const message = document.getElementById('message');

                        if (!validateForm(vehicle, driver, passengers, price_per_km)) {
                            message.style.color = "red";
                            message.innerText = "Please fix the errors above.";
                            return;
                        }

                        const cab = {vehicle, driver, passengers, price_per_km};

                        fetch('http://localhost:8080/MegaCityService/resources/cabs', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(cab)
                        })
                                .then(response => {
                                    if (response.status === 201) {
                                        message.style.color = "green";
                                        message.innerText = "Cab added successfully!";
                                        clearForm();
                                        closeAddCabModal(); // Close the modal after successful addition
                                        loadCabs(); // Refresh the cab list
                                    } else {
                                        message.style.color = "red";
                                        message.innerText = "Failed to add cab. Try again.";
                                    }
                                })
                                .catch(error => {
                                    console.error('Error:', error);
                                    message.style.color = "red";
                                    message.innerText = "An error occurred.";
                                });
                    }

                    // Function to clear the form
                    function clearForm() {
                        document.getElementById('vehicle').value = "";
                        document.getElementById('driver').value = "";
                        document.getElementById('passengers').value = "";
                        document.getElementById('price_per_km').value = "";
                        document.getElementById('message').innerText = "";
                        document.getElementById('vehicleError').innerText = "";
                        document.getElementById('driverError').innerText = "";
                        document.getElementById('passengersError').innerText = "";
                        document.getElementById('price_per_kmError').innerText = "";
                    }

                    // Function to validate the form
                    function validateForm(vehicle, driver, passengers, price_per_km) {
                        let isValid = true;

                        // Vehicle validation (Allow alphanumeric and spaces, minimum 3 characters)
                        if (!/^[A-Za-z0-9\s]{3,}$/.test(vehicle)) {
                            document.getElementById('vehicleError').innerText = "Enter a valid vehicle name (Min 3 characters, alphanumeric allowed).";
                            isValid = false;
                        } else {
                            document.getElementById('vehicleError').innerText = "";
                        }

                        // Driver validation (Allow alphabets and spaces, minimum 3 characters)
                        if (!/^[A-Za-z\s]{3,}$/.test(driver)) {
                            document.getElementById('driverError').innerText = "Enter a valid driver name (Min 3 characters, alphabets only).";
                            isValid = false;
                        } else {
                            document.getElementById('driverError').innerText = "";
                        }

                        // Passengers validation (Only numbers, min 1)
                        if (!/^\d{1,}$/.test(passengers)) {
                            document.getElementById('passengersError').innerText = "Enter a valid number of passengers.";
                            isValid = false;
                        } else {
                            document.getElementById('passengersError').innerText = "";
                        }

                        // Price per km validation (Only numbers, min 1)
                        if (!/^\d{1,}$/.test(price_per_km)) {
                            document.getElementById('price_per_kmError').innerText = "Enter a valid price per km.";
                            isValid = false;
                        } else {
                            document.getElementById('price_per_kmError').innerText = "";
                        }

                        return isValid;
                    }

                    // Function to show the "Manage Cabs" section
                    function showManageCabs() {
                    document.getElementById("main-content").innerHTML = `
                            <div class="container">
                                    <h2>Manage Cabs</h2>
                                        <div class="cab-cards-container" id="cabs-list">
                                        <!-- Cab cards will be populated here -->
                                    </div>
                                <button onclick="showAddCabModal()" style="margin-top: 20px;">Add New Cab</button>
                                    </div>
                                    `;
                                    loadCabs(); // Fetch and display cabs
                                }
                    
                    // Function to load cabs from the server
                    function loadCabs() {
                            fetch("http://localhost:8080/MegaCityService/resources/cabs")
                            .then(response => response.json())
                            .then(cabs => {
                            const cabsList = document.getElementById("cabs-list");
                                    cabsList.innerHTML = ''; // Clear previous content
                                    cabs.forEach(cab => {
                                    const cabCard = document.createElement("div");
                                            cabCard.classList.add("cab-card");
                                            cabCard.innerHTML = `
                                <i class="fa-solid fa-car"></i>
                                <h3>${cab.vehicle}</h3>
                                <p><strong>Driver:</strong> ${cab.driver}</p>
                                <p><strong>Passengers:</strong> ${cab.passengers}</p>
                                <p><strong>Price per km:</strong> ${cab.price_per_km}</p>
                                <div class="button-group">
                                    <button onclick="editCab(${cab.id})">Edit</button>
                                    <button class="delete-btn" onclick="deleteCab(${cab.id})">Delete</button>
                                </div>
                            `;
                            cabsList.appendChild(cabCard);
                        });
                    })
                    .catch(error => console.error('Error fetching cabs:', error));
            }

            // Function to edit a cab (placeholder)
            function editCab(cabId) {
                alert(`Edit Cab with ID: ${cabId}`);
            }

            // Function to delete a cab
            function deleteCab(cabId) {
                if (confirm("Are you sure you want to delete this cab?")) {
                    fetch(`http://localhost:8080/MegaCityService/resources/cabs/${cabId}`, {
                        method: "DELETE"
                    })
                    .then(response => {
                        if (response.ok) {
                            alert("Cab deleted successfully!");
                            loadCabs(); // Refresh the cab list
                        } else {
                            alert("Failed to delete cab.");
                        }
                    })
                    .catch(error => {
                        console.error("Error deleting cab:", error);
                        alert("Failed to delete cab. Please try again.");
                    });
                }
            }

            // Function to show the "Manage Bookings" section
            function showManageBookings() {
                document.getElementById("main-content").innerHTML = `
                    <div class="container">
                        <h2>Manage Bookings</h2>
                        <table class="booking-table" id="bookings-list">
                            <thead>
                                <tr>
                                    <th>Booking ID</th>
                                    <th>Customer Name</th>
                                    <th>Vehicle</th>
                                    <th>Pickup Location</th>
                                    <th>Drop-off Location</th>
                                    <th>Time</th>
                                    <th>Price</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Booking rows will be populated here -->
                            </tbody>
                        </table>
                    </div>
                `;
                loadBookings(); // Fetch and display bookings
            }

            // Function to load bookings from the server
            function loadBookings() {
                fetch("http://localhost:8080/MegaCityService/resources/bookings")
                    .then(response => response.json())
                    .then(bookings => {
                        const bookingsTable = document.querySelector("#bookings-list tbody");
                        bookingsTable.innerHTML = ''; // Clear previous content
                        bookings.forEach(booking => {
                            const bookingRow = document.createElement("tr");
                            bookingRow.innerHTML = `
                                <td>${booking.id}</td>
                                <td>${booking.customerName}</td>
                                <td>${booking.vehicle}</td>
                                <td>${booking.pickupLocation}</td>
                                <td>${booking.dropoffLocation}</td>
                                <td>${booking.time}</td>
                                <td>${booking.price.toFixed(2)}</td>
                                <td><button onclick="cancelBooking(${booking.id})">Cancel</button></td>
                            `;
                            bookingsTable.appendChild(bookingRow);
                        });
                    })
                    .catch(error => console.error('Error fetching bookings:', error));
            }

            // Function to cancel a booking
            function cancelBooking(bookingId) {
                if (confirm("Are you sure you want to cancel this booking?")) {
                    fetch(`http://localhost:8080/MegaCityService/resources/bookings/${bookingId}`, {
                        method: "DELETE"
                    })
                    .then(response => {
                        if (response.ok) {
                            alert("Booking canceled successfully!");
                            loadBookings(); // Refresh the booking list
                        } else {
                            alert("Failed to cancel booking.");
                        }
                    })
                    .catch(error => {
                        console.error("Error canceling booking:", error);
                        alert("Failed to cancel booking. Please try again.");
                    });
                }
            }
        </script>
    </body>
</html>